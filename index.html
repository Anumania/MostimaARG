

<script>
mosawake = false;
transparency = 0;
storypart = 0;
storychar = 0;
speed = 60;
story = ["...",
"Youve made a horrible mistake, coming here.",
"We both know why youre here, and we both know you arent leaving until you get it",
"Maybe you should try getting some bitches instead"
]
images = ["https://media.discordapp.net/attachments/623381118552375313/812210903566516224/MOSTIMA_DRIP_3.png?width=319&height=558", 
"https://media.discordapp.net/attachments/623381118552375313/812210895181709333/MOSTIMA_DRIP.png?width=319&height=558",
"https://media.discordapp.net/attachments/623381118552375313/812210813984833546/MOSTIMA_DRIP_2.png?width=319&height=558",
"https://media.discordapp.net/attachments/623381118552375313/812210920306376734/MOSTIMA_DRIP_SANS.png?width=319&height=558"]
count = 0;
img = 0;
inter = 0;
window.onload = function(){
	interv = setInterval(refresh, 1000/60);
	loadImages();
	
}

refresh = function(){
	count++;
	if(count%speed == 0 && mosawake == true){
		storychar++;
	}
	if(count>100 && !mosawake){
		transparency+=0.01;
		document.getElementById("mos").style.opacity=transparency;
		if(document.getElementById("mos").style.opacity > 1){
			mosawake = true;
		}
	}
	if(mosawake){
		document.getElementById("textbox").innerHTML = story[storypart].substring(0,storychar)

	}
	switch(storypart){
		 case 0: document.getElementById("mos").src = images[0]; break;
		 case 1: document.getElementById("mos").src = images[2]; speed = 5;  break;
		 case 2: document.getElementById("mos").src = images[0]; break;
		 case 2: document.getElementById("mos").src = images[1]; break;
		}
	if(storychar >= story[storypart].length && storypart == story.length-1){ //if the vn part is done, we go.
		time_for_game();
	}
}
ongo = function(b){
	if(mosawake && storychar >= story[storypart].length){
		if(story.length > storypart){
			storychar = 0;
			storypart++;
		}
	}
	if(b.code == "Digit9"){ //skip for debugging
		time_for_game();
	}
}
time_for_game = function(){//kill everything and get the canvas started.
	document.getElementById("mos").src = " ";
	document.getElementById("mos").style.opacity = 0;
	document.getElementById("textbox").innerHTML = "stop snooping wait for me to finish my shit before lookingx`";
	document.getElementById("canvas").width = 800;
	document.getElementById("canvas").height = 400;
	window.onclick = function(){}
	clearInterval(interv);
	document.removeEventListener('keypress', ongo);
	//gameCreate();
}
window.onclick = ongo;
document.addEventListener('keypress', ongo);



loadImages = function(){ //this lets the images load while the vn is happenin.
	sprites["soul"] = newImage("Red_SOUL_sprite.png");
}
newImage = function(str){
	var n = new Image();
	n.src = str;
	return n;
}
sprites = new Map();
loopTimer = 0;
canvas = 0;
game = 0;
gameObjects = [];
gameKeys = new Array(200);//every key and then some
function ord(str){return str.toLowerCase().charCodeAt(0);}
function chr(num){return String.fromCharCode(num);}
keydown = function(_key){
	gameKeys[ord(_key.key)] = true;
}
keyup = function(_key){
	gameKeys[ord(_key.key)] = false;
}
gameCreate = function(){
	document.body.style.backgroundColor = 0x000000
	canvas = document.getElementById("canvas");
	game = canvas.getContext("2d");
	loopTimer = setInterval(gameRefresh, 1000/60);
	canvas.style = "position:absolute; margin-top: 150px;left: 50%; width: 800px; margin-left: -400px";
	document.addEventListener('keydown', keydown);
	document.addEventListener('keyup', keyup);
	new BulletBoard(0,0);
	new Player(50,50);
	//new TextBox(400,300);
}

gameRefresh = function(){
	//event.keyCode
	game.fillStyle = "black"; //wipe screen.
	game.fillRect(0,0,800,600);
	for(var i = 0; i < gameObjects.length; i++){//step
		gameObjects[i].step();
	}
	for(var i = 0; i < gameObjects.length; i++){//draw
		gameObjects[i].draw();
	}
}
addToStepList = function(gameObject){
	gameObjects.push(gameObject);
}


class GameObject{
	x = 0;
	y = 0;
	width = 0;
	height = 0;
	sprite = 0;
	constructor(_x,_y){
		this.x = _x;
		this.y = _y;
		this.width = 16;
		this.height = 16;
		this.sprite = sprites["soul"];//this needs to be replaced or you will always be soul;
		addToStepList(this);
	}

	drawSelf(){
		game.drawImage(this.sprite,this.x,this.y,this.width,this.height);
	}
	//thanks https://stackoverflow.com/questions/3793397/html5-canvas-drawimage-with-at-an-angle
	rotateAndPaintImage = function( context, image, angleInRad , positionX, positionY, axisX, axisY ) {
		context.translate( positionX, positionY );
		context.rotate( angleInRad );
		context.drawImage( image, -axisX, -axisY );
		context.rotate( -angleInRad );
		context.translate( -positionX, -positionY );
	}
	draw = function(){return;};
	step = function(){return;};


}

class Player extends GameObject{
	speed = 3;
	bulletBoard = 0;
	state = 0;
	constructor(_x,_y){
		super(_x,_y);
		this.state = this.redMove;
		for(var j = 0; j < gameObjects.length; j++){
			if(gameObjects[j].__proto__.constructor === BulletBoard){
				console.log(gameObjects[j]);
				this.bulletBoard = gameObjects[j];
			} 
		}
	}
	step = function(){
		this.state();
	}
	draw = function(){
		this.drawSelf();

	}

	redMove = function(){ //red heart from undytale
		if(gameKeys[ord("j")]){this.x-=this.speed};
		if(gameKeys[ord("i")]){this.y-=this.speed};
		if(gameKeys[ord("l")]){this.x+=this.speed};
		if(gameKeys[ord("k")]){this.y+=this.speed};

		this.x = Util.Clamp(this.x,this.bulletBoard.x, this.bulletBoard.x+this.bulletBoard.width);
		this.y = Util.Clamp(this.y,this.bulletBoard.y, this.bulletBoard.y+this.bulletBoard.height);
	}
	blueMove = function(){//blue heart from undytale

	}
	UIMove = function(){

	}

}
class TextBox extends GameObject{
	targetw = 1000;//must be divisible by 20
	targeth = 200; //also must be divisible by 20
	constructor(_x,_y){
		super(_x,_y);
		this.width = 0;
		this.height =0;
		
	}
	step = function(){
		return;
	}
	draw = function(){
		game.fillStyle = "black";
		game.fillRect(this.x-(this.width/4),this.y-(this.height/4),this.width/2,this.height/2); 
		game.strokeStyle = "white";
		game.lineWidth = 4;
		game.strokeRect(this.x-(this.width/4),this.y-(this.height/4),this.width/2,this.height/2);
		if(this.width != this.targetw || this.height != this.targeth){
			this.width += Math.sign(this.targetw-this.width)*20;
			this.height += Math.sign(this.targeth-this.height)*20;
		}
		else{
			game.font = "17px elfont";
			game.fillStyle = "white"
			game.fillText("*  Mostima is dripping",this.x-this.width/4+10,this.y-this.height/4+30);
		}
		
	}
}
class BulletBoard extends GameObject{
	step = function(){
		this.x = 300;
		this.width = 300;
		this.y = 300;
		this.height = 300;
	}
	draw = function(){
		game.fillStyle = "black";
		game.fillRect(this.x,this.y,this.width,this.height); 
		game.strokeStyle = "white";
		game.lineWidth = 4;
		game.strokeRect(this.x,this.y,this.width,this.height);		
	}
}
class MostimaSecondSkill extends GameObject{

}
class MostimaThirdSkill extends GameObject{

}
class Util{
	static Clamp(val,min,max){
		return Math.max(Math.min(val,min),max);
	} 
}




//game time


</script>

<style>
@font-face {
font-family: 'elfont';
src: url('font1.ttf');
}
.center {
  display: block;
  margin-left: auto;
  word-break: keep-all;
  margin-right: auto;
  width: 20%;
  text-align: center;
 }
img {
  opacity: 0.0;
}
</style>
<canvas id="canvas" width="0" height="0" style="center"> </canvas>
<img src = "https://media.discordapp.net/attachments/623381118552375313/812210920306376734/MOSTIMA_DRIP_SANS.png?width=319&height=558" id="mos" class = "center"></img>
<p id = "textbox" class = "center"> </p>
</html>